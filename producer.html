<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Car Producer</title>

    <link rel="stylesheet" type="text/css" href="main.css">

    <script src="./node_modules/web3/dist/web3.min.js"></script>
    <style>

    h1 { 
       background-color: green;
       color: white;
    }
    

    </style>

    <style>
       table {
        width:100%;
       }
       table, th, td {
           border: 1px solid black;
           border-collapse: collapse;    
       }
       th, td {
           padding: 5px;
           text-align: left;
       }    
       table#t01 tr:nth-child(even) {
           background-color: #eee;
       }
       table#t01 tr:nth-child(odd) {
           background-color:#fff;
       }
       table#t01 th {
       background-color: gray;
       color: white;
       }
       table#t02 th {
       background-color: grey;
       color: white;
       }
    </style>

</head>

<body>
    <div class="container">

        <h1>Car Registration </h1>
        <span id="firm_details"></span> 
        
        
  <table id="t02">
   <tr>
    <td id="tbl02xA1"></td>
    <td id="tbl02xB1"></td>
    <td id="tbl02xC1"></td>
    <td id="tbl02xD1"></td>
    <td id="tbl02xE1"></td>
    <td id="tbl02xF1"></td>
  </tr>
 </table>
              
        <span id="countIns"></span>
  
        <h2>Register a  single car</h2>
 
        <label for="carAdr" class="col-lg-2 control-label">Blockchain Adresse</label>
        <input id="carAdr" type="text">

        <label for="carType" class="col-lg-2 control-label">Typ </label>
        <input id="carType" type="text">

        <label for="carSerial" class="col-lg-2 control-label">Fahrgestellnummer</label>
        <input id="carSerial" type="text">

        <button id="button1">Produce Item</button>

        <img id="loader" src="https://loading.io/spinners/double-ring/lg.double-ring-spinner.gif">
 
        <span id="transactionOk"></span>
        <span id="registration"></span>


 		  <br>
        <hr>
     

        <h2>Car Details by Blockchain Address</h2>
 
        <img id="qr" src='https://chart.googleapis.com/chart?cht=qr&chl=0x7a701451dC7aE33c23a5349B378c6950a8044f0E&chs=180x180&choe=UTF-8&chld=L|2' alt='qr code'>
              

<table id="t01">
  <tr>
    <th>Address</th>
    <th>Producer</th> 
    <th>Type</th>
    <th>Serial</th>
    <th>Owner</th>

  </tr>

  <tr>
    <td id="tbl01xA1"></td>
    <td id="tbl01xB1"></td>
    <td id="tbl01xC1"></td>
    <td id="tbl01xD1"></td>
    <td id="tbl01xE1"></td>  
  </tr>
  <tr>
    <td id="tbl01xA2"></td>
    <td id="tbl01xB2"></td>
    <td id="tbl01xC2"></td>
    <td id="tbl01xD2"></td>
    <td id="tbl01xE2"></td>  
  </tr>
  <tr>
    <td id="tbl01xA3"></td>
    <td id="tbl01xB3"></td>
    <td id="tbl01xC3"></td>
    <td id="tbl01xD3"></td>
    <td id="tbl01xE3"></td>  
  </tr>
  <tr>
    <td id="tbl01xA4"></td>
    <td id="tbl01xB4"></td>
    <td id="tbl01xC4"></td>
    <td id="tbl01xD4"></td>
    <td id="tbl01xE4"></td>  
  </tr>
  <tr>
    <td id="tbl01xA5"></td>
    <td id="tbl01xB5"></td>
    <td id="tbl01xC5"></td>
    <td id="tbl01xD5"></td>
    <td id="tbl01xE5"></td>  
  </tr>
 <tr>
    <td id="tbl01xA6"></td>
    <td id="tbl01xB6"></td>
    <td id="tbl01xC6"></td>
    <td id="tbl01xD6"></td>
    <td id="tbl01xE6"></td>  
  </tr>
  <tr>
    <td id="tbl01xA7"></td>
    <td id="tbl01xB7"></td>
    <td id="tbl01xC7"></td>
    <td id="tbl01xD7"></td>
    <td id="tbl01xE7"></td>  
  </tr>
  <tr>
    <td id="tbl01xA8"></td>
    <td id="tbl01xB8"></td>
    <td id="tbl01xC8"></td>
    <td id="tbl01xD8"></td>
    <td id="tbl01xE8"></td>  
  </tr>
  <tr>
    <td id="tbl01xA9"></td>
    <td id="tbl01xB9"></td>
    <td id="tbl01xC9"></td>
    <td id="tbl01xD9"></td>
    <td id="tbl01xE9"></td>  
  </tr>
  <tr>
    <td id="tbl01xA10"></td>
    <td id="tbl01xB10"></td>
    <td id="tbl01xC10"></td>
    <td id="tbl01xD10"></td>
    <td id="tbl01xE10"></td>  
  </tr>



</table>




   </div>




    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

    <script src="./abi.js"></script>



    <script>
     var car01 = '0x7a701451dC7aE33c23a5349B378c6950a8044f0E';
     var car02 = '0xf4B02651b117f0EfeB853127A78bA958eB74FAe0';
     var car03 = '0x4B20f638da74193c9B6c84E134d784C54a3aE5Be';
     var car04 = '0xC548EA01f579638FC872DA77ae61f97508EAecB2';
     var car05 = '0xd3E906CA20D9A8B0C21B9eA9651067c4D6F885ED';
     var car06 = '0xafE53F8812258d478af118B7c6c7Ffc444Dc6db8';
     var car07 = '0xb01fdB5eBBBF6B91cc2aD7662366Bbc6fC8Be9Ba';
     var car08 = '0x36efd911C57A80528A47e111617540fa932641ee';
     var car09 = '0x505B54a76C2C4c3F6E84e8430d208219B996CdF0';
     var car10 = '0xbF587b829DF36719d9051b6fb98D985ac7462964';
   
     var cars= ['0x7a701451dC7aE33c23a5349B378c6950a8044f0E', '0xf4B02651b117f0EfeB853127A78bA958eB74FAe0'];
             
    var firm01 = '0x46aed27379c94784160b56b89ee1564de0cf11db';
      

    function displayCars() {
 
    CarChain.displayCar((car01),(err, res) => {
           if (res) {
                 $("#tbl01xA1").html( car01 );   
                 $("#tbl01xB1").html( web3.toAscii(res[0]) );   
                 $("#tbl01xC1").html( web3.toAscii(res[4]) );   
                 $("#tbl01xD1").html( web3.toAscii(res[5]) );   
                 $("#tbl01xE1").html( web3.toAscii(res[1]) );                    
           }  
        });   

    CarChain.displayCar((car02),(err, res) => {
           if (res) {
                 $("#tbl01xA2").html( car02 );   
                 $("#tbl01xB2").html( web3.toAscii(res[0]) );   
                 $("#tbl01xC2").html( web3.toAscii(res[4]) );   
                 $("#tbl01xD2").html( web3.toAscii(res[5]) );   
                 $("#tbl01xE2").html( web3.toAscii(res[1]) );                    
           }  
        });   

    CarChain.displayCar((car03),(err, res) => {
           if (res) {
                 $("#tbl01xA3").html( car03 );   
                 $("#tbl01xB3").html( web3.toAscii(res[0]) );   
                 $("#tbl01xC3").html( web3.toAscii(res[4]) );   
                 $("#tbl01xD3").html( web3.toAscii(res[5]) );   
                 $("#tbl01xE3").html( web3.toAscii(res[1]) );                    
           }  
        });   

    CarChain.displayCar((car04),(err, res) => {
           if (res) {
                 $("#tbl01xA4").html( car04 );   
                 $("#tbl01xB4").html( web3.toAscii(res[0]) );   
                 $("#tbl01xC4").html( web3.toAscii(res[4]) );   
                 $("#tbl01xD4").html( web3.toAscii(res[5]) );   
                 $("#tbl01xE4").html( web3.toAscii(res[1]) );                    
           }  
        });   

   CarChain.displayCar((car05),(err, res) => {
           if (res) {
                 $("#tbl01xA5").html( car05 );   
                 $("#tbl01xB5").html( web3.toAscii(res[0]) );   
                 $("#tbl01xC5").html( web3.toAscii(res[4]) );   
                 $("#tbl01xD5").html( web3.toAscii(res[5]) );   
                 $("#tbl01xE5").html( web3.toAscii(res[1]) );  
                 
           }  
        });   

   CarChain.displayCar((car06),(err, res) => {
           if (res) {
                 $("#tbl01xA6").html( car06 );   
                 $("#tbl01xB6").html( web3.toAscii(res[0]) );   
                 $("#tbl01xC6").html( web3.toAscii(res[4]) );   
                 $("#tbl01xD6").html( web3.toAscii(res[5]) );   
                 $("#tbl01xE6").html( web3.toAscii(res[1]) );  
                 
           }  
        });   
        
  
    CarChain.displayCar((car07),(err, res) => {
           if (res) {
                 $("#tbl01xA7").html( car07 );   
                 $("#tbl01xB7").html( web3.toAscii(res[0]) );   
                 $("#tbl01xC7").html( web3.toAscii(res[4]) );   
                 $("#tbl01xD7").html( web3.toAscii(res[5]) );   
                 $("#tbl01xE7").html( web3.toAscii(res[1]) );  
                 
           }  
        });   
   CarChain.displayCar((car08),(err, res) => {
           if (res) {
                 $("#tbl01xA8").html( car08 );   
                 $("#tbl01xB8").html( web3.toAscii(res[0]) );   
                 $("#tbl01xC8").html( web3.toAscii(res[4]) );   
                 $("#tbl01xD8").html( web3.toAscii(res[5]) );   
                 $("#tbl01xE8").html( web3.toAscii(res[1]) );  
                 
           }  
        });   
   CarChain.displayCar((car09),(err, res) => {
           if (res) {
                 $("#tbl01xA9").html( car09 );   
                 $("#tbl01xB9").html( web3.toAscii(res[0]) );   
                 $("#tbl01xC9").html( web3.toAscii(res[4]) );   
                 $("#tbl01xD9").html( web3.toAscii(res[5]) );   
                 $("#tbl01xE9").html( web3.toAscii(res[1]) );  
                 
           }  
        });   
   CarChain.displayCar((car10),(err, res) => {
           if (res) {
                 $("#tbl01xA10").html( car10 );   
                 $("#tbl01xB10").html( web3.toAscii(res[0]) );   
                 $("#tbl01xC10").html( web3.toAscii(res[4]) );   
                 $("#tbl01xD10").html( web3.toAscii(res[5]) );   
                 $("#tbl01xE10").html( web3.toAscii(res[1]) );  
                 
           }  
        });   
    
  } //end of function displayCars




  
     $("#qr").hide(); 





 //event
     var carCreationEvent = CarChain.carInfo({}, 'latest');

 
    carCreationEvent.watch(function (err, result) {
    if (!err) {
        if (result.blockHash != $("#transactionOk").html()) 
            $("#loader").hide();
            
        $("#transactionOk").html('<font color="grey"> Block hash: ' +result.blockHash + '</font><br>');
        $("#registration").html(
                 '<font color="grey"> Last Registration: ' + 
                 (result.args.eCarAddress) + ' ' + 'Type: ' + 
                 web3.toAscii(result.args.eType) + ' ' + 
                 '</font><br><br> '
                 );
        displayCars();  
        console.log (result.args.eCarAddress);
        console.log (result.args.eType);
        console.log (result.args.eSerial);
        
       
    } else {
        $("#loader").hide();
    }
  });
//end event 
    
    
 /*   CarChain.getFirmAdr((0),(err, res) => {
           if (res) {
               myAcc= web3.eth.defaultAccount;
               $("#tbl02xA1").html(myAcc);
                 
           }  
        });   
        
        
*/
      
    
    CarChain.displayFirm((firm01),(err, res) => {
           if (res) {
                  //$("#tbl02xA1").html( firm01 );
                  var myAcc = web3.eth.defaultAccount;
                  $("#tbl02xA1").html(myAcc);
                  $("#tbl02xB1").html( web3.toAscii(res[0]) );   
                  $("#tbl02xC1").html( web3.toAscii(res[1]) );   
                  $("#tbl02xD1").html( web3.toAscii(res[2]) );   
                     
           }  
        });   

    CarChain.balanceOf((firm01),(err, res) => {
           if (res) {
                        $("#tbl02xE1").html( res.c +' €' );                     
           }  
        });   
 
    web3.eth.getBalance(firm01, function(error, result){
            if(!error){
               var myBala=result/1000000000/1000000/1000;
               var num= myBala.toFixed(3)
               console.log('balance'+ JSON.stringify(result))   ;
               $("#tbl02xF1").html(num  + ' Ether'); 
            }
                
            else
               console.error(error);
        });

   
    
  
 
  
  displayCars();        
     
    $("#button1").click(
    	function() {
    		
    		CarChain.registerCar($("#carAdr").val(), $("#carType").val(),$("#carSerial").val(), (err, res) => {
			$("#loader").show();  			      	
        		if (err) 
            	$("#loader").hide();
      	});
    });
         
     
         
       
    
    </script>

</body>
</html>
